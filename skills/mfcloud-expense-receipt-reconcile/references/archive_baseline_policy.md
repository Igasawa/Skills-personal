# 月次アーカイブ基本設定（定例運用）

このドキュメントは、月次作業の終了時に必ず実施する「保管」と「クリーン化」の標準手順を定義する。

## 1. 目的

- 対象月の作業内容と成果物を保全し、後日再現できる状態を残す
- 次回作業開始時に、前月由来ファイルの混入がないクリーンな状態を作る

## 2. 対象範囲（保管）

対象月ディレクトリ:

`AX_HOME/artifacts/mfcloud-expense-receipt-reconcile/YYYY-MM/`

保管対象は原則として上記配下の全成果物とする。最低限、次を含める:

- `reports/`
- `amazon/`
- `rakuten/`
- `mfcloud/`
- `manual/`（共通フォルダを含む）
- `mf_bulk_upload/`（アップロード用フォルダを含む）
- `debug/`
- `run_config.resolved.json`

## 3. 実施タイミング

- 月次処理の完了後（提出前の最終確認が終わった時点）
- Step5の完了と同一タイミングで実施する

## 4. 実施手順（定例）

1. 対象月を確認する（`YYYY-MM`）。
2. アーカイブを作成する。
3. アーカイブ先と件数を確認する。
4. クリーンアップ対象を空にする。
5. 次回開始前に空状態を再確認する。

## 5. クリーンアップ対象（次月開始条件）

次を「空」で開始できること:

- `manual/inbox/`
- `mf_bulk_upload/inbox/`
- `debug/`（必要時のみ保持）

## 6. 完了条件

- 対象月の成果物が保管先に存在する
- 監査ログを含めて追跡可能である
- 次月開始時の入力用フォルダが空である

## 7. 実装状況メモ

- `scripts/archive_outputs.ps1` は月ディレクトリ全体をアーカイブ対象とする
- アーカイブ時に `full_snapshot.zip` / `manifest.json` / `checksums.sha256` を生成する
- 既定動作で `manual/inbox` / `mf_bulk_upload/inbox` / `debug` をクリーンアップする（`-NoCleanup` で無効化）
