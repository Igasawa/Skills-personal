<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ workflow_template.name | default('ワークフローテンプレート', true) }}</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div
      class="page workflow-copy-page"
      data-active-tab="{{ active_tab | default('wizard-copy', true) }}"
      data-sidebar-links='{{ (sidebar_links | default([], true)) | tojson }}'
      data-workflow-template='{{ (workflow_template | default({}, true)) | tojson }}'
      data-template-mode='{{ template_mode | default("new", true) }}'
    >
      <header class="hero">
        <div>
          <p
            id="workflow-template-page-subheading"
            class="eyebrow"
            {% if not workflow_template or not workflow_template.subheading %}hidden{% endif %}
          >
            {{ workflow_template.subheading | default('', true) }}
          </p>
          <h1 id="workflow-template-page-title" data-default-title="ワークフローテンプレート">
            {{ workflow_template.name | default('ワークフローテンプレート', true) }}
          </h1>
          <p class="subtitle">
            テンプレートを複製して、将来のワークフロー起動時に再利用できる形で保存します。
          </p>
        </div>
      </header>

      <section class="card">
          <div class="template-mode-summary">
          <div class="template-mode-summary-head">
            <h2>ワークフローテンプレート</h2>
            <span id="workflow-template-mode-chip" class="template-mode-chip">新規</span>
          </div>
          <p class="muted" id="workflow-template-mode-description"></p>
          <p class="muted" id="workflow-template-mode-summary"></p>
          <div id="workflow-template-source-meta" class="template-copy-source hidden">
            <p class="template-copy-source-title">複製元情報</p>
            <p>複製元: <span id="workflow-template-source-name">-</span></p>
            <p>更新日時: <span id="workflow-template-source-updated">-</span></p>
            <div class="template-copy-source-actions">
              <a id="workflow-template-edit-source" class="secondary" href="#" hidden>複製元テンプレートを開く</a>
              <a id="workflow-template-copy-source" class="secondary" href="#" hidden>複製元から複製する</a>
            </div>
          </div>
        </div>
        <h2>テンプレート設定</h2>
        <form id="run-form" class="form">
          <input type="hidden" name="template_id" value="{{ template_id | default('', true) }}" />
          <input type="hidden" name="template_mode" value="{{ template_mode | default('new', true) }}" />
          <input type="hidden" name="template_source_id" value="{{ template_source_id | default('', true) }}" />
          <input type="hidden" name="template_updated_at" value="{{ template_updated_at | default('', true) }}" />
          <div class="form-row">
            <label>
              テンプレート名
              <input
                type="text"
                name="template_name"
                value="{{ workflow_template.name | default('', true) }}"
                placeholder="例: 12月分"
                required
              />
            </label>
            <label>
              年
              <input type="number" name="year" value="{{ defaults.year }}" min="2000" max="2100" required />
            </label>
            <label>
              月
              <input type="number" name="month" value="{{ defaults.month }}" min="1" max="12" required />
            </label>
          </div>
          <label>
            小見出し（任意）
            <input
              type="text"
              name="template_subheading"
              value="{{ workflow_template.subheading | default('', true) }}"
              placeholder="例: Amazon / 楽天 / その他"
            />
          </label>
          <label for="template-source-url-primary">ソースURL（任意）</label>
          <div id="template-source-url-list" class="template-source-url-list" data-source-url-list>
            <div class="form-row template-source-url-row" data-source-url-row>
              <input
                id="template-source-url-primary"
                type="url"
                name="mfcloud_url"
                value="{{ defaults.mfcloud_url }}"
                data-source-url-input
                placeholder="https://example.com/path"
              />
              <button type="button" class="secondary" data-source-url-remove aria-label="このURL行を削除">-</button>
            </div>
          </div>
          <div class="form-row">
            <button type="button" id="template-source-url-add" class="secondary">+ URLを追加</button>
          </div>
          <label>
            メモ
            <input
              type="text"
              name="notes"
              value="{{ defaults.notes }}"
              placeholder="テンプレートの備考を入力できます"
            />
          </label>
          <input type="hidden" name="rakuten_orders_url" value="{{ defaults.rakuten_orders_url }}" />
          <div class="form-row">
            <button type="button" id="workflow-page-create" class="primary">ワークフローを作成</button>
            <button type="button" id="workflow-template-save" class="secondary">テンプレートを保存</button>
            <span class="muted">「ワークフローを作成」は新しいページを追加します。「テンプレートを保存」は雛形を更新します。</span>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>アーカイブ済みワークフロー</h2>
        <p class="muted">不要なワークフローを復元できます。</p>
        <div id="workflow-archive-list" class="workflow-archive-list"></div>
        <p id="workflow-archive-empty" class="muted">アーカイブ済みワークフローはありません。</p>
      </section>

      {% include "components/expense_workflow_card.html" %}

    </div>

    <div id="toast" class="toast" aria-live="polite"></div>
    <script src="/static/js/common.js"></script>
    <script src="/static/js/index.js"></script>
    <script src="/static/js/scheduler.js"></script>
  </body>
</html>
