<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>業務自動化準備ハブ</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div
      class="page workspace-page"
      data-active-tab="{{ active_tab | default('workspace', true) }}"
      data-sidebar-links='{{ (sidebar_links | default([], true)) | tojson }}'
    >
      <header class="hero">
        <div>
          <p class="eyebrow">Automation Hub</p>
          <h1>業務自動化準備ハブ</h1>
          <p class="subtitle">
            ここはエージェントが実行する場所ではなく、人が自動化運用を準備する管理画面です。リンク先、目的、エージェント向けプロンプトをまとめて管理します。
          </p>
        </div>
      </header>

      <section class="card workspace-intent-card">
        <h2>このページの使い方</h2>
        <ul class="workspace-intent-list">
          <li>自動化で使うリンク先を登録・更新する。</li>
          <li>各リンクの目的とエージェント向けプロンプトを整備する。</li>
          <li>担当者・推奨エージェント・最終見直し日を確認してから実行する。</li>
        </ul>
      </section>

      <section class="grid two">
        <div class="card">
          <h2>固定リンク</h2>
          <p class="muted">月次経費処理で必須のリンクです。</p>
          <ul class="workspace-link-list workspace-link-list-static">
            <li class="workspace-link-item" data-details-expanded="0">
              <div class="workspace-link-main" data-full-url="https://expense.moneyforward.com/expense_reports">
                <div class="workspace-link-head">
                  <a
                    class="secondary workspace-link-open"
                    data-workspace-link-open
                    href="https://expense.moneyforward.com/expense_reports"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="https://expense.moneyforward.com/expense_reports"
                    aria-label="MF経費精算ページを開く（https://expense.moneyforward.com/expense_reports）"
                  >
                    MF経費精算ページ
                  </a>
                  <button type="button" class="workspace-url-toggle" data-workspace-url-toggle aria-label="詳細を表示">詳細</button>
                </div>
              </div>
              <div class="workspace-link-details" data-workspace-link-details>
                <a
                  class="workspace-link-domain"
                  href="https://expense.moneyforward.com/expense_reports"
                  target="_blank"
                  rel="noopener noreferrer"
                  title="https://expense.moneyforward.com/expense_reports"
                >
                  expense.moneyforward.com
                </a>
                <div
                  class="workspace-prompt-front"
                  data-prompt-front
                  data-prompt-key="mf_expense_reports"
                  data-prompt-label="MF経費精算ページ"
                  data-prompt-url="https://expense.moneyforward.com/expense_reports"
                ></div>
                <label class="workspace-link-note">
                  <span class="workspace-link-note-label">目的</span>
                  <textarea
                    class="workspace-link-note-editor"
                    rows="3"
                    maxlength="4000"
                    placeholder="このリンクを使う目的"
                    data-workspace-link-note
                    data-note-key="mf_expense_reports"
                  ></textarea>
                </label>
                <div class="workspace-link-profile-grid">
                  <label>
                    担当者
                    <input
                      type="text"
                      maxlength="80"
                      placeholder="例: 経理 田中"
                      data-workspace-link-owner
                      data-profile-key="mf_expense_reports"
                    />
                  </label>
                  <label>
                    推奨エージェント
                    <select data-workspace-link-agent data-profile-key="mf_expense_reports">
                      <option value="">未設定</option>
                      <option value="codex">Codex</option>
                      <option value="chatgpt">ChatGPT</option>
                      <option value="claude">Claude</option>
                      <option value="gemini">Gemini</option>
                      <option value="other">その他</option>
                    </select>
                  </label>
                  <label>
                    最終見直し日
                    <input type="date" data-workspace-link-reviewed-on data-profile-key="mf_expense_reports" />
                  </label>
                </div>
                <p class="workspace-link-review-status" data-workspace-link-review-status data-profile-key="mf_expense_reports"></p>
                <div class="workspace-link-actions">
                  <button
                    type="button"
                    class="secondary workspace-copy-url"
                    data-copy-url="https://expense.moneyforward.com/expense_reports"
                  >
                    URLをコピー
                  </button>
                  <button
                    type="button"
                    class="secondary workspace-copy-prompt"
                    data-prompt-key="mf_expense_reports"
                  >
                    プロンプトをコピー
                  </button>
                  <button
                    type="button"
                    class="secondary workspace-edit-prompt"
                    data-prompt-key="mf_expense_reports"
                  >
                    編集
                  </button>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="card">
          <h2>追加リンク</h2>
          <p class="muted">必要に応じてリンクを追加できます。</p>
          <form id="workspace-link-form" class="form workspace-link-form">
            <label for="workspace-link-label">
              リンク名
              <input
                id="workspace-link-label"
                type="text"
                name="label"
                maxlength="80"
                placeholder="例: MF経費申請一覧"
                required
              />
            </label>
            <label for="workspace-link-url">
              URL
              <input
                id="workspace-link-url"
                type="url"
                name="url"
                placeholder="https://..."
                required
              />
            </label>
            <label for="workspace-link-purpose">
              目的
              <textarea
                id="workspace-link-purpose"
                name="purpose"
                rows="3"
                maxlength="4000"
                placeholder="例: 月次申請の承認状況を確認する"
              ></textarea>
            </label>
            <div class="workspace-link-form-meta form-row">
              <label for="workspace-link-owner">
                担当者
                <input
                  id="workspace-link-owner"
                  type="text"
                  name="owner"
                  maxlength="80"
                  placeholder="例: 経理 田中"
                />
              </label>
              <label for="workspace-link-agent">
                推奨エージェント
                <select id="workspace-link-agent" name="agent">
                  <option value="">未設定</option>
                  <option value="codex">Codex</option>
                  <option value="chatgpt">ChatGPT</option>
                  <option value="claude">Claude</option>
                  <option value="gemini">Gemini</option>
                  <option value="other">その他</option>
                </select>
              </label>
              <label for="workspace-link-reviewed-on">
                最終見直し日
                <input id="workspace-link-reviewed-on" type="date" name="reviewed_on" />
              </label>
            </div>
            <div class="step-actions">
              <button type="submit" class="primary">リンクを追加</button>
              <button type="button" class="secondary" id="workspace-clear-links">追加リンクを全削除</button>
            </div>
          </form>
          <ul id="workspace-custom-links" class="workspace-link-list"></ul>
          <p id="workspace-custom-links-empty" class="muted">追加リンクはまだありません。</p>
        </div>
      </section>

      <section class="card workspace-prompt-card">
        <h2>エージェント向けプロンプト編集</h2>
        <p class="muted">
          プロンプト本文を自由に編集し、ワンクリックでコピーできます。実行時は「実行指示セットをコピー」でURLや目的と一緒に渡せます。
        </p>
        <div class="muted">編集対象: <span id="workspace-prompt-active-label">MF経費精算ページ</span></div>
        <label for="workspace-prompt-editor">
          プロンプト本文
          <textarea
            id="workspace-prompt-editor"
            class="workspace-prompt-editor"
            rows="14"
            spellcheck="false"
          ></textarea>
        </label>
        <div class="workspace-prompt-meta">
          <span id="workspace-prompt-status" class="muted">自動保存待機中。</span>
          <span id="workspace-prompt-count" class="muted">0 文字</span>
        </div>
        <div class="step-actions">
          <button type="button" id="workspace-save-prompt" class="primary">登録</button>
          <button type="button" id="workspace-copy-handoff" class="secondary">実行指示セットをコピー</button>
        </div>
        <div class="workspace-token-help">
          <span class="workspace-token-chip">{month}</span>
          <span class="workspace-token-chip">{reports_path}</span>
          <span class="workspace-token-chip">{notes}</span>
        </div>
      </section>
    </div>

    <div id="toast" class="toast" aria-live="polite"></div>
    <script src="/static/js/common.js"></script>
    <script src="/static/js/workspace.js"></script>
  </body>
</html>
